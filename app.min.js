function main(){function t(t){d3.json('./lib/110m.json').then(function(e){var n=d3.select('svg.world-map'),a=n.attr('viewBox').split(' '),o=a[2],c=a[3],l=d3.geoRobinson().translate([o/2,c/2]).scale(o/(2*Math.PI)),s=d3.geoPath().projection(l);n.select('path.land').attr('d',s(topojson.feature(e,e.objects.land))),n.selectAll('circle.cities').data(t.features).enter().append('circle').attr('r',r).attr('cx',function(t){return s.centroid(t)[0];}).attr('cy',function(t){return s.centroid(t)[1];}).classed('cities',!0).attr('filter','url(#glowFilter)').style('fill','url(#radialGradient)').filter(function(t,e){return 0===e;}).raise().attr('r',i);});}function e(t){var o=t.shift(),c=t[0];t.push(o);var l=flubber.interpolate(o.pathString,c.pathString);d3.selectAll('path.circuit-path-main, path.circuit-path-glow').transition().duration(n).delay(a).attrTween('d',function(){return l;}).on('start',function(t,e){0===e&&(d3.timeout(function(){d3.select('.circuit-info-text').text(c.name);},.5*d3.active(this).duration()),d3.selectAll('circle.cities').filter(function(t){return t.properties.Name===o.name;}).transition().duration(n).attr('r',r),d3.selectAll('circle.cities').filter(function(t){return t.properties.Name===c.name;}).raise().transition().duration(n).attr('r',i));}).on('end',function(r,i){0===i&&e(t);});}var r=2,i=10,n=1250,a=1e3;d3.json('./F1_Circuits_2018_topojson.json').then(function(r){var i=topojson.feature(r,r.objects.F1_Circuits_2018),n=d3.select('svg.circuits-map'),a=n.attr('viewBox').split(' '),o=a[2],c=a[3],l=i.features.map(function(t){var e=d3.geoCentroid(t),r=[-e[0],-e[1]],i=d3.geoMercator().translate([o/2,c/2]).scale(2400*o).rotate(r),n=d3.geoPath(i);return{pathString:n(t),name:t.properties.Name};});n.selectAll('path.circuit-path-main, path.circuit-path-glow').attr('d',l[0].pathString),d3.select('.circuit-info-text').text(l[0].name),e(l),t(i);});}function loadScript(t,e){var r=document.createElement('script');r.src=t,r.onload=function(){e();},r.onerror=function(){var e=new Error('Failed to load script '+t);console.error(e);},document.body.appendChild(r);}window.Promise&&window.fetch?main():loadScript('https://cdn.polyfill.io/v2/polyfill.min.js?features=Promise,fetch',main);
